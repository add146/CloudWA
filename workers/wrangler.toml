name = "cloudwa-flow"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# WhatsApp Gateway via WAHA HTTP API (deployed separately)
# WAHA_BASE_URL and WAHA_API_KEY set via wrangler secret

# Database D1
[[d1_databases]]
binding = "DB"
database_name = "cloudwa-flow-db"
database_id = "75b8fc35-c6cb-4994-9938-e1e159c18356"
migrations_dir = "src/db/migrations"

# Object Storage R2
[[r2_buckets]]
binding = "SESSION_BUCKET"
bucket_name = "cloudwa-sessions"

[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "cloudwa-media"

[[r2_buckets]]
binding = "DOCS_BUCKET"
bucket_name = "cloudwa-docs"

# Message Queue for Broadcast (optional - can be added later)
# [[queues.producers]]
# binding = "BLAST_QUEUE"
# queue = "broadcast-queue"
# 
# [[queues.consumers]]
# queue = "broadcast-queue"
# max_batch_size = 10
# max_batch_timeout = 5
# max_concurrency = 5

# Vector Database for RAG
[[vectorize]]
binding = "VECTOR_INDEX"
index_name = "cloudwa-rag-index"

# Workers AI
[ai]
binding = "AI"

# Environment Variables (set via wrangler secret)
# JWT_SECRET - Secret for JWT signing
# Run: wrangler secret put JWT_SECRET
